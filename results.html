<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tafuta | Results</title>
    <link rel="shortcut icon" href="tafuta_icon.png" type="image/x-icon">
    <style>
        * {
            padding: 0;
            margin: 0;
            font-family: system-ui;
        }

        ::-webkit-scrollbar {
            width: 0.45vw;
            background-color: gainsboro;
        }

        ::-webkit-scrollbar-thumb {
            background: orange;
        }

        html {
            scroll-behavior: smooth;
            display: none;
        }

        article {
            padding: 4.5% 0;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: rgb(47, 79, 79);
            border-bottom: 0.25vw solid orange;
            user-select: none;
        }

        .top-nav {
            display: flex;
            margin: 1vh;
            align-items: center;
        }

        .bottom-nav {
            background-color: rgba(255, 255, 255, 0.075);            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .search-bar {
            display: flex;
            background-color: snow;
            margin: 1vh 5vw;
            border-radius: 3px;
        }

        #bar {
            outline: none;
            font-size: clamp(10px, 1.15vw, 55px);
            border-right: 0.15vw solid gainsboro;
            color: #555;
            margin: 0.5vw;
            padding: 0.35vw;
            border-bottom: snow 0 solid;
            border-top: snow 0 solid;
            border-left: snow 0 solid;
            width: 35vw;
        }

        #search-btn {
            padding: 0.35vw 1vw;
            background-color: orange;
            border: none;
            margin: 0.5vw;
            color: #fff;
            clip-path: circle(40% at 50% 50%);
            font-size: clamp(8px, 1.15vw, 50px);
            cursor: pointer;
            transition: 300ms ease;
        }

        #search-btn:hover, #search-btn:active, #search-btn:focus {
            background-color: rgb(255, 193, 79);
        }

        nav img {
            height: 4vh;
            cursor: pointer;
            margin: 0 1vw;
        }

        nav ul li {
            list-style: none;
            display: inline;
        }

        .tabs {
            color: snow;
            font-size: clamp(10px, 1.35vw, 45px);
            text-decoration: none;
            text-transform: capitalize;
            padding: 0.25vw;
            margin: 1vh 1.25vw;
            position: relative;
            transition: 300ms ease;
        }

        .results-layout {
            display: flex;
            justify-content: center;
        }

        .container {
            width: 65%;
            margin: 0 1vw;
            padding: 1.25vw;
            border-radius: 5px;
        }

        /* .page-nav {
            margin-top: 5%;
            display: flex;
            justify-self: center;
        }

        .page-nav-container {
            font-size: clamp(8px, 1.5vw, 65px);
        }

        .page-btn {
            background-color: orange;
            padding: 0.35vw 1vw;
            clip-path: circle(40% at 50% 50%);
            color: #fff;
            cursor: pointer;
            transition: 300ms ease;
        }

        .page-btn:hover, .page-btn:active, .page-btn:focus {
            background-color: rgb(255, 193, 79);
        }

        h1 {
            text-align: center;
        } */

        .art-3 {
            background-color: whitesmoke;
            padding: 0;
            position: relative;
            box-sizing: border-box;
        }

        .copyright {
            font-size: clamp(12px, 2vw, 60px);
            margin: 1vw;
            color: #888;
        }

        .copy-bottom {
            background-color: orange;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5vh 0;
        }

        .policies a {
            color: snow;
            margin: 0 1.5vw;
            font-size: clamp(8px, 1.1vw, 35px);
            text-transform: capitalize;
            text-decoration: none;
        }

        .socials a {
            color: snow;
            margin: 0 0.5vw;
            font-size: clamp(8px, 1.1vw, 35px);
            text-decoration: none;
        }

        .ads {
            display: flex;
            justify-content: space-evenly;
            padding: 2vh 0;
            background-color: rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <nav>
        <div class="top-nav">
            <a href="tafuta.html"><img src="tafuta_logo_text.png" alt="logo"></a>
            <div class="search-bar">
                <input type="text" id="bar">
                <button type="button" id="search-btn"><i class="bi bi-search"></i></button>
            </div>
        </div>
        <div class="bottom-nav">
            <ul>
                <li><a href="#" class="tabs" id="results-link">results</a></li>
            </ul>
        </div>
    </nav>
    <main>
        <article class="art-1"></article>
        <article class="art-2">
            <div class="results-layout">
                <div class="container" id="content-container">
                    <div id="results"></div>
                </div>
            </div>
        </article>
        <article class="art-3">
            <header class="copyright">&copy; 2024 - <script>const webDate = new Date(); document.write(webDate.getUTCFullYear());</script> Tafuta</header>
            <div class="copy-bottom">
                <div class="policies">
                    <a href="help.html">help</a>
                    <!--a href="tos.html">terms of service</a-->
                    <a href="hiring.html">hiring</a>
                </div>
                <div class="socials">
                    <a target="_blank" href="https://www.youtube.com/channel/UCXp9EU47nYP8Ws-DDFEFj-g"><i class="bi bi-youtube"></i></a>
                    <a target="_blank" href="https://x.com/officialtafuta"><i class="bi bi-twitter"></i></a>
                    <a target="_blank" href="https://www.tiktok.com/@officialtafuta"><i class="bi bi-tiktok"></i></a>
                </div>
            </div>
            <div class="ads"></div>
        </article>
    </main>
    <script>
        // Run search when the page loads based on the initial query parameter
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const query = params.get('query');

            if (query) {
                document.getElementById('bar').value = query;
                performSearch(query);
            } else {
                document.querySelector('html').style.display = 'block'; // Show HTML if no query
            }
        };

        // Function to perform the search and display results
        async function performSearch(query) {
            const headers = new Headers();
            headers.append("X-API-KEY", "e48e54cf65e9ea7de1da123c2854d780c61758f1");
            headers.append("Content-Type", "application/json");

            const body = JSON.stringify({ "q": query, "num": 30 });

            const requestOptions = {
                method: 'POST',
                headers: headers,
                body: body,
                redirect: 'follow'
            };

            try {
                const response = await fetch("https://google.serper.dev/search", requestOptions);
                const data = await response.json();
                displayResults(data);

                document.querySelector('html').style.display = 'block';

            } catch (error) {
                console.error('Error fetching search results:', error);
                document.getElementById('results').innerHTML = "<p style='color: gainsboro; font-size: clamp(10px, 1.75vw, 60px);'>Failed to load results.</p>";

                document.querySelector('html').style.display = 'block';
            }
        }

        // Display search results function remains the same
        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // Clear previous results

            if (data.organic && data.organic.length > 0) {
                data.organic.forEach(item => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    resultItem.innerHTML = `
                        <header style="margin-top: 4vh; margin-bottom: 1vh;">
                            <a style="font-size: clamp(10px, 1.75vw, 60px); color: orange;" href="${item.link}" target="_self">${item.title}</a>
                        </header>
                        <p style="font-size: clamp(8px, 1.15vw, 35px);">${item.snippet}</p>
                    `;
                    resultsDiv.appendChild(resultItem);
                });
            } else {
                resultsDiv.innerHTML = '<p>No results found.</p>';
            }
        }

        // Event listener for #search-btn and Enter key to refresh results
        document.getElementById('search-btn').addEventListener('click', () => {
            const query = document.getElementById('bar').value.trim();
            if (query) {
                performSearch(query);
            }
        });

        document.getElementById('bar').addEventListener('keypress', (e) => {
            if (e.key === "Enter") {
                const query = document.getElementById("bar").value.trim();
                if (query) {
                    performSearch(query);
                }
            }
        });
    </script>
    <noscript>Please enable JavaScript in order to see the page's results.</noscript>
</body>
</html>